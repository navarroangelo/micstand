<div class="relative w-full h-full bg-base-100">
  <!-- Leaflet Map Container -->
  <div id="emergenciesMap" class="w-full h-full"></div>

  <!-- Emergency Type Filters - Top Left (Collapsible) -->
  <div
    class="absolute top-2 left-2 sm:top-4 sm:left-4 lg:top-6 lg:left-6 bg-white/95 backdrop-blur-md rounded-xl sm:rounded-2xl shadow-lg p-2 sm:p-4 border border-gray-200/50 transition-all duration-300 ease-in-out z-[400] cursor-pointer"
    [class.w-auto]="!isFiltersExpanded"
    [class.w-40]="isFiltersExpanded"
    [class.sm:w-60]="isFiltersExpanded"
    [class.lg:w-64]="isFiltersExpanded"
    (click)="toggleFiltersExpanded($event)">
    <div class="flex items-center justify-between mb-0" [class.mb-2]="isFiltersExpanded" [class.sm:mb-3]="isFiltersExpanded">
      <div class="flex items-center gap-2">
        <h3 class="font-semibold text-[10px] sm:text-sm text-gray-800">Filters</h3>
        <!-- Chevron -->
        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 text-gray-500 transition-transform duration-300" [class.rotate-180]="isFiltersExpanded" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
        </svg>
      </div>
      <span class="text-[9px] sm:text-xs font-medium text-gray-400" [class.hidden]="!isFiltersExpanded">{{ getActiveFilterCount() }}/{{ emergencyTypes.length }}</span>
    </div>
    <div class="space-y-1 sm:space-y-1.5 hidden" [class.!block]="isFiltersExpanded">
      <button
        *ngFor="let type of emergencyTypes"
        class="group w-full flex items-center justify-between px-1.5 py-1.5 sm:px-3 sm:py-2.5 rounded-lg sm:rounded-xl transition-all duration-200"
        [class.bg-gradient-to-r]="type.active"
        [class.from-primary]="type.active"
        [class.to-primary/90]="type.active"
        [class.shadow-sm]="type.active"
        [class.hover:bg-gray-50]="!type.active"
        [class.bg-gray-50/50]="!type.active"
        (click)="toggleFilter(type.id); $event.stopPropagation()">
        <div class="flex items-center gap-1.5 sm:gap-2.5">
          <div class="text-sm sm:text-lg leading-none">{{ type.icon }}</div>
          <span class="font-medium text-[10px] sm:text-sm leading-none"
                [class.text-white]="type.active"
                [class.text-gray-700]="!type.active">
            {{ type.label }}
          </span>
        </div>
        <div class="flex items-center gap-1 sm:gap-2">
          <span class="text-[9px] sm:text-xs font-semibold px-1 py-0.5 rounded-md min-w-[16px] sm:min-w-[20px] text-center"
                [class.bg-white/25]="type.active"
                [class.text-white]="type.active"
                [class.bg-gray-200]="!type.active"
                [class.text-gray-600]="!type.active">
            {{ getEmergencyCountByType(type.id) }}
          </span>
          <div class="w-3 h-3 sm:w-4 sm:h-4 rounded-full border-2 flex items-center justify-center transition-all"
               [class.border-white]="type.active"
               [class.bg-white]="type.active"
               [class.border-gray-300]="!type.active"
               [class.bg-transparent]="!type.active">
            <svg *ngIf="type.active" xmlns="http://www.w3.org/2000/svg" class="h-1.5 w-1.5 sm:h-2.5 sm:w-2.5 text-primary" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
            </svg>
          </div>
        </div>
      </button>
    </div>
  </div>

  <!-- Stats Card - Top Right (Simplified for mobile) -->
  <div class="absolute top-2 right-2 sm:top-4 sm:right-4 lg:top-6 lg:right-6 bg-base-100 rounded-xl sm:rounded-2xl shadow-strong p-2 sm:p-4 border border-base-300/20 min-w-[140px] sm:min-w-[180px] lg:min-w-[200px] z-[400]">
    <h3 class="font-bold text-[10px] sm:text-sm text-base-content mb-1 sm:mb-3">Active Emergencies</h3>
    <div class="space-y-1 sm:space-y-2.5 text-[9px] sm:text-sm">
      <div class="flex items-center justify-between">
        <span class="text-base-content/70 leading-none">High Priority</span>
        <span class="badge badge-xs sm:badge-sm text-white font-semibold" style="background-color: #ef4444;">{{ getEmergencyCountBySeverity('high') }}</span>
      </div>
      <div class="flex items-center justify-between">
        <span class="text-base-content/70 leading-none">Medium</span>
        <span class="badge badge-xs sm:badge-sm text-white font-semibold" style="background-color: #f59e0b;">{{ getEmergencyCountBySeverity('medium') }}</span>
      </div>
      <div class="flex items-center justify-between">
        <span class="text-base-content/70 leading-none">Low Priority</span>
        <span class="badge badge-xs sm:badge-sm text-white font-semibold" style="background-color: #3b82f6;">{{ getEmergencyCountBySeverity('low') }}</span>
      </div>
    </div>
  </div>

  <!-- Emergency Report Button - Bottom Left (Adjusted for bottom nav) -->
  <div class="absolute bottom-4 left-2 sm:bottom-4 sm:left-4 lg:bottom-6 lg:left-6 z-[400]">
    <app-emergency-report-button></app-emergency-report-button>
  </div>

  <!-- AI Chatbot Button - Bottom Right (Adjusted for bottom nav) -->
  <div class="absolute bottom-4 right-2 sm:bottom-4 sm:right-4 lg:bottom-6 lg:right-6 z-[400]">
    <app-ai-chatbot-button></app-ai-chatbot-button>
  </div>
</div>
